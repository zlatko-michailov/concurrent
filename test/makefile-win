OUTDIR=$(MAKEDIR)\..\out
SRCDIR=$(MAKEDIR)
INCLUDEDIR=$(MAKEDIR)\..\src
OBJDIR=$(OUTDIR)\obj
SRCDIR=$(MAKEDIR)
EXE=$(OUTDIR)\test.exe
OBJ=$(OBJDIR)\main.obj
H=$(INCLUDEDIR)\*.h
CPPFLAGS=-c -W4 -EHs -Od -D:DEBUG
LINK=link.exe
LINKFLAGS=-debug:full -out:$(EXE)

all: clean build test pack

clean:
    @rd /s /q $(OUTDIR)
    @md $(OUTDIR)\obj

pack: test
    @xcopy $(INCLUDEDIR)\*.h $(OUTDIR)\include /y /i

test: build
    $(EXE)

build: $(EXE)

$(EXE): $(OBJ)
    $(LINK) $(LINKFLAGS) $(OBJ)

$(OBJ): $(SRCDIR)\$(*B).cpp $(H) $(MAKEFILE)
    $(CPP) $(CPPFLAGS) -Fo: $@ $(SRCDIR)\$(*B).cpp

